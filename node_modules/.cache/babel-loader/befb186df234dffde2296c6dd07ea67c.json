{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.v1 = void 0;\n/* eslint-disable no-bitwise */\nconst stringify_1 = require(\"./stringify\");\nconst rng_1 = require(\"./rng\");\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\nlet _nodeId;\nlet _clockseq;\n// Previous uuid creation time\nlet _lastMSecs = 0;\nlet _lastNSecs = 0;\n// See https://github.com/uuidjs/uuid for API details\nconst v1 = function (options, buf) {\n  let offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  let i = buf && offset || 0;\n  const b = buf || new Uint8Array(16);\n  let node = options && options.node ? options.node : _nodeId;\n  let clockseq = options && options.clockseq ? options.clockseq : _clockseq;\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    const seedBytes = options && options.random ? options.random : options && options.rng ? options.rng() : (0, rng_1.rng)();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  let msecs = options && options.msecs ? options.msecs : Date.now();\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  let nsecs = options && options.nsecs ? options.nsecs : _lastNSecs + 1;\n  // Time since last uuid creation (in msecs)\n  const dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000;\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options && !options.clockseq) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options && !options.nsecs) {\n    nsecs = 0;\n  }\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n  // `time_low`\n  const tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n  // `time_mid`\n  const tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n  // `node`\n  for (let n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n  return buf || (0, stringify_1.stringify)(b);\n};\nexports.v1 = v1;","map":{"version":3,"names":["stringify_1","require","rng_1","_nodeId","_clockseq","_lastMSecs","_lastNSecs","v1","options","buf","offset","arguments","length","undefined","i","b","Uint8Array","node","clockseq","seedBytes","random","rng","msecs","Date","now","nsecs","dt","Error","tl","tmh","n","stringify","exports"],"sources":["../src/v1.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA;AACA,MAAAA,WAAA,GAAAC,OAAA;AACA,MAAAC,KAAA,GAAAD,OAAA;AAWA;AACA;AACA;AACA;AAEA,IAAIE,OAAiB;AACrB,IAAIC,SAAiB;AAErB;AACA,IAAIC,UAAU,GAAG,CAAC;AAClB,IAAIC,UAAU,GAAG,CAAC;AAElB;AACO,MAAMC,EAAE,GAAG,SAAAA,CAChBC,OAAmB,EACnBC,GAAgB,EAEd;EAAA,IADFC,MAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAiB,CAAC;EAElB,IAAIG,CAAC,GAAIL,GAAG,IAAIC,MAAM,IAAK,CAAC;EAC5B,MAAMK,CAAC,GAAGN,GAAG,IAAI,IAAIO,UAAU,CAAC,EAAE,CAAC;EAEnC,IAAIC,IAAI,GAAGT,OAAO,IAAIA,OAAO,CAACS,IAAI,GAAGT,OAAO,CAACS,IAAI,GAAGd,OAAO;EAC3D,IAAIe,QAAQ,GAAGV,OAAO,IAAIA,OAAO,CAACU,QAAQ,GAAGV,OAAO,CAACU,QAAQ,GAAGd,SAAS;EAEzE;EACA;EACA;EACA,IAAIa,IAAI,IAAI,IAAI,IAAIC,QAAQ,IAAI,IAAI,EAAE;IACpC,MAAMC,SAAS,GACbX,OAAO,IAAIA,OAAO,CAACY,MAAM,GACrBZ,OAAO,CAACY,MAAM,GACdZ,OAAO,IAAIA,OAAO,CAACa,GAAG,GACtBb,OAAO,CAACa,GAAG,EAAE,GACb,IAAAnB,KAAA,CAAAmB,GAAG,GAAE;IAEX,IAAIJ,IAAI,IAAI,IAAI,EAAE;MAChB;MACAA,IAAI,GAAGd,OAAO,GAAG,CACfgB,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,EACnBA,SAAS,CAAC,CAAC,CAAC,EACZA,SAAS,CAAC,CAAC,CAAC,EACZA,SAAS,CAAC,CAAC,CAAC,EACZA,SAAS,CAAC,CAAC,CAAC,EACZA,SAAS,CAAC,CAAC,CAAC,CACb;IACH;IAEA,IAAID,QAAQ,IAAI,IAAI,EAAE;MACpB;MACAA,QAAQ,GAAGd,SAAS,GAAG,CAAEe,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,GAAIA,SAAS,CAAC,CAAC,CAAC,IAAI,MAAM;IACtE;EACF;EAEA;EACA;EACA;EACA;EACA,IAAIG,KAAK,GAAWd,OAAO,IAAIA,OAAO,CAACc,KAAK,GAAGd,OAAO,CAACc,KAAK,GAAGC,IAAI,CAACC,GAAG,EAAE;EAEzE;EACA;EACA,IAAIC,KAAK,GAAWjB,OAAO,IAAIA,OAAO,CAACiB,KAAK,GAAGjB,OAAO,CAACiB,KAAK,GAAGnB,UAAU,GAAG,CAAC;EAE7E;EACA,MAAMoB,EAAE,GAAWJ,KAAK,GAAGjB,UAAU,GAAG,CAACoB,KAAK,GAAGnB,UAAU,IAAI,KAAK;EAEpE;EACA,IAAIoB,EAAE,GAAG,CAAC,IAAIlB,OAAO,IAAI,CAACA,OAAO,CAACU,QAAQ,EAAE;IAC1CA,QAAQ,GAAIA,QAAQ,GAAG,CAAC,GAAI,MAAM;EACpC;EAEA;EACA;EACA,IAAI,CAACQ,EAAE,GAAG,CAAC,IAAIJ,KAAK,GAAGjB,UAAU,KAAKG,OAAO,IAAI,CAACA,OAAO,CAACiB,KAAK,EAAE;IAC/DA,KAAK,GAAG,CAAC;EACX;EAEA;EACA,IAAIA,KAAK,IAAI,KAAK,EAAE;IAClB,MAAM,IAAIE,KAAK,CAAC,iDAAiD,CAAC;EACpE;EAEAtB,UAAU,GAAGiB,KAAK;EAClBhB,UAAU,GAAGmB,KAAK;EAClBrB,SAAS,GAAGc,QAAQ;EAEpB;EACAI,KAAK,IAAI,cAAc;EAEvB;EACA,MAAMM,EAAE,GAAG,CAAC,CAACN,KAAK,GAAG,SAAS,IAAI,KAAK,GAAGG,KAAK,IAAI,WAAW;EAC9DV,CAAC,CAACD,CAAC,EAAE,CAAC,GAAIc,EAAE,KAAK,EAAE,GAAI,IAAI;EAC3Bb,CAAC,CAACD,CAAC,EAAE,CAAC,GAAIc,EAAE,KAAK,EAAE,GAAI,IAAI;EAC3Bb,CAAC,CAACD,CAAC,EAAE,CAAC,GAAIc,EAAE,KAAK,CAAC,GAAI,IAAI;EAC1Bb,CAAC,CAACD,CAAC,EAAE,CAAC,GAAGc,EAAE,GAAG,IAAI;EAElB;EACA,MAAMC,GAAG,GAAKP,KAAK,GAAG,WAAW,GAAI,KAAK,GAAI,SAAS;EACvDP,CAAC,CAACD,CAAC,EAAE,CAAC,GAAIe,GAAG,KAAK,CAAC,GAAI,IAAI;EAC3Bd,CAAC,CAACD,CAAC,EAAE,CAAC,GAAGe,GAAG,GAAG,IAAI;EAEnB;EACAd,CAAC,CAACD,CAAC,EAAE,CAAC,GAAKe,GAAG,KAAK,EAAE,GAAI,GAAG,GAAI,IAAI,CAAC,CAAC;EACtCd,CAAC,CAACD,CAAC,EAAE,CAAC,GAAIe,GAAG,KAAK,EAAE,GAAI,IAAI;EAE5B;EACAd,CAAC,CAACD,CAAC,EAAE,CAAC,GAAII,QAAQ,KAAK,CAAC,GAAI,IAAI;EAEhC;EACAH,CAAC,CAACD,CAAC,EAAE,CAAC,GAAGI,QAAQ,GAAG,IAAI;EAExB;EACA,KAAK,IAAIY,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAE,EAAEA,CAAC,EAAE;IAC1Bf,CAAC,CAACD,CAAC,GAAGgB,CAAC,CAAC,GAAGb,IAAI,CAACa,CAAC,CAAC;EACpB;EAEA,OAAOrB,GAAG,IAAI,IAAAT,WAAA,CAAA+B,SAAS,EAAChB,CAAC,CAAC;AAC5B,CAAC;AAxGYiB,OAAA,CAAAzB,EAAE,GAAAA,EAAA","ignoreList":[]},"metadata":{},"sourceType":"script"}