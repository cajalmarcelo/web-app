{"ast":null,"code":"import{FETCH_FLEETADMIN_EARNING,FETCH_FLEETADMIN_EARNING_SUCCESS,FETCH_FLEETADMIN_EARNING_FAILED}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{get,onValue}from\"firebase/database\";export const fetchFleetAdminEarnings=()=>async dispatch=>{const{bookingListRef,settingsRef}=firebase;dispatch({type:FETCH_FLEETADMIN_EARNING,payload:null});const userInfo=store.getState().auth.profile;const settingsdata=await get(settingsRef);const settings=settingsdata.val();onValue(bookingListRef(userInfo.uid,userInfo.usertype),snapshot=>{if(snapshot.val()){const{singleUserRef}=firebase;const mainArr=snapshot.val();var monthsName=['January','February','March','April','May','June','July','August','September','October','November','December'];var renderobj={};Object.keys(mainArr).map(j=>{if((mainArr[j].status==='PAID'||mainArr[j].status==='COMPLETE')&&mainArr[j].fleetCommission!==undefined&&mainArr[j].fleetCommission>0){let bdt=new Date(mainArr[j].tripdate);let uniqueKey=bdt.getFullYear()+'_'+bdt.getMonth()+'_'+mainArr[j].fleetadmin;if(renderobj[uniqueKey]&&renderobj[uniqueKey].fleetCommission>0){renderobj[uniqueKey].fleetCommission=(parseFloat(renderobj[uniqueKey].fleetCommission)+parseFloat(mainArr[j].fleetCommission)).toFixed(settings.decimal);renderobj[uniqueKey]['total_rides']=renderobj[uniqueKey]['total_rides']+1;}else{onValue(singleUserRef(mainArr[j].fleetadmin),async userdata=>{if(userdata.val()){let user=await userdata.val();if(user){renderobj[uniqueKey]['fleetadminName']=user.firstName+\" \"+user.lastName;}}});renderobj[uniqueKey]={};renderobj[uniqueKey]['dated']=mainArr[j].tripdate;renderobj[uniqueKey]['year']=bdt.getFullYear();renderobj[uniqueKey]['month']=bdt.getMonth();renderobj[uniqueKey]['monthsName']=monthsName[bdt.getMonth()];renderobj[uniqueKey]['fleetCommission']=parseFloat(mainArr[j].fleetCommission).toFixed(settings.decimal);renderobj[uniqueKey]['fleetUId']=mainArr[j].fleetadmin;renderobj[uniqueKey]['uniqueKey']=uniqueKey;renderobj[uniqueKey]['total_rides']=1;}}return null;});if(renderobj){const arr=Object.keys(renderobj).map(i=>{renderobj[i].fleetCommission=parseFloat(renderobj[i].fleetCommission).toFixed(settings.decimal);return renderobj[i];});dispatch({type:FETCH_FLEETADMIN_EARNING_SUCCESS,payload:arr});}}else{dispatch({type:FETCH_FLEETADMIN_EARNING_FAILED,payload:\"No data available.\"});}});};","map":{"version":3,"names":["FETCH_FLEETADMIN_EARNING","FETCH_FLEETADMIN_EARNING_SUCCESS","FETCH_FLEETADMIN_EARNING_FAILED","store","firebase","get","onValue","fetchFleetAdminEarnings","dispatch","bookingListRef","settingsRef","type","payload","userInfo","getState","auth","profile","settingsdata","settings","val","uid","usertype","snapshot","singleUserRef","mainArr","monthsName","renderobj","Object","keys","map","j","status","fleetCommission","undefined","bdt","Date","tripdate","uniqueKey","getFullYear","getMonth","fleetadmin","parseFloat","toFixed","decimal","userdata","user","firstName","lastName","arr","i"],"sources":["C:/Users/CAJAL/Desktop/main/Sourcecode/common/src/actions/fleetadminearningaction.js"],"sourcesContent":["import {\n  FETCH_FLEETADMIN_EARNING,\n  FETCH_FLEETADMIN_EARNING_SUCCESS,\n  FETCH_FLEETADMIN_EARNING_FAILED,\n} from \"../store/types\";\nimport store from '../store/store';\nimport { firebase } from '../config/configureFirebase';\nimport { get, onValue } from \"firebase/database\";\n\nexport const fetchFleetAdminEarnings = () => async (dispatch) => {\n\n  const {\n    bookingListRef,\n    settingsRef\n  } = firebase;\n\n  dispatch({\n    type: FETCH_FLEETADMIN_EARNING,\n    payload: null\n  });\n\n  const userInfo = store.getState().auth.profile;\n  const settingsdata = await get(settingsRef);\n  const settings = settingsdata.val();\n\n  onValue(bookingListRef(userInfo.uid, userInfo.usertype), snapshot => {\n    if (snapshot.val()) {\n      const { singleUserRef } = firebase;\n      const mainArr = snapshot.val();\n      var monthsName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n      var renderobj = {};\n      Object.keys(mainArr).map(j => {\n\n        if ((mainArr[j].status === 'PAID' || mainArr[j].status === 'COMPLETE') && mainArr[j].fleetCommission !== undefined && mainArr[j].fleetCommission > 0) {\n          let bdt = new Date(mainArr[j].tripdate);\n          let uniqueKey = bdt.getFullYear() + '_' + bdt.getMonth() + '_' + mainArr[j].fleetadmin;\n          if (renderobj[uniqueKey] && renderobj[uniqueKey].fleetCommission > 0) {\n            renderobj[uniqueKey].fleetCommission = (parseFloat(renderobj[uniqueKey].fleetCommission) + parseFloat(mainArr[j].fleetCommission)).toFixed(settings.decimal);\n            renderobj[uniqueKey]['total_rides'] = renderobj[uniqueKey]['total_rides'] + 1;\n          } else {\n            onValue(singleUserRef(mainArr[j].fleetadmin), async userdata => {\n              if (userdata.val()) {\n                let user = await userdata.val();\n                if(user){\n                  renderobj[uniqueKey]['fleetadminName'] = user.firstName + \" \" + user.lastName;\n                }\n              }\n            });\n            \n            renderobj[uniqueKey] = {};\n            renderobj[uniqueKey]['dated'] = mainArr[j].tripdate;\n            renderobj[uniqueKey]['year'] = bdt.getFullYear();\n            renderobj[uniqueKey]['month'] = bdt.getMonth();\n            renderobj[uniqueKey]['monthsName'] = monthsName[bdt.getMonth()];\n            renderobj[uniqueKey]['fleetCommission'] = parseFloat(mainArr[j].fleetCommission).toFixed(settings.decimal);\n            renderobj[uniqueKey]['fleetUId'] = mainArr[j].fleetadmin;\n            renderobj[uniqueKey]['uniqueKey'] = uniqueKey;\n            renderobj[uniqueKey]['total_rides'] = 1;\n          }\n        }\n        return null;\n      });\n      if (renderobj) {\n        const arr = Object.keys(renderobj).map(i => {\n          renderobj[i].fleetCommission = parseFloat(renderobj[i].fleetCommission).toFixed(settings.decimal)\n          return renderobj[i]\n        })\n        dispatch({\n          type: FETCH_FLEETADMIN_EARNING_SUCCESS,\n          payload: arr\n        });\n      }\n\n    } else {\n      dispatch({\n        type: FETCH_FLEETADMIN_EARNING_FAILED,\n        payload: \"No data available.\"\n      });\n    }\n  });\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}