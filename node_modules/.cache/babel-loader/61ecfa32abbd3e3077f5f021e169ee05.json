{"ast":null,"code":"import{FETCH_BOOKING_LOCATION,FETCH_BOOKING_LOCATION_SUCCESS,FETCH_BOOKING_LOCATION_FAILED,STOP_LOCATION_FETCH,STORE_ADRESSES}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{query,onValue,set,off,push,limitToLast}from\"firebase/database\";export const saveTracking=(bookingId,location)=>{const{trackingRef}=firebase;push(trackingRef(bookingId),location);};export const fetchBookingLocations=bookingId=>dispatch=>{const{trackingRef}=firebase;dispatch({type:FETCH_BOOKING_LOCATION,payload:bookingId});onValue(query(trackingRef(bookingId),limitToLast(1)),snapshot=>{if(snapshot.val()){let data=snapshot.val();const locations=Object.keys(data).map(i=>{return data[i];});if(locations.length==1){dispatch({type:FETCH_BOOKING_LOCATION_SUCCESS,payload:locations[0]});}else{dispatch({type:FETCH_BOOKING_LOCATION_FAILED,payload:store.getState().languagedata.defaultLanguage.location_fetch_error});}}else{dispatch({type:FETCH_BOOKING_LOCATION_FAILED,payload:store.getState().languagedata.defaultLanguage.location_fetch_error});}});};export const stopLocationFetch=bookingId=>dispatch=>{const{trackingRef}=firebase;dispatch({type:STOP_LOCATION_FETCH,payload:bookingId});off(trackingRef(bookingId));};export const saveUserLocation=location=>{const{auth,userLocationRef}=firebase;const uid=auth.currentUser.uid;set(userLocationRef(uid),location);};export const storeAddresses=data=>dispatch=>{dispatch({type:STORE_ADRESSES,payload:data});};","map":{"version":3,"names":["FETCH_BOOKING_LOCATION","FETCH_BOOKING_LOCATION_SUCCESS","FETCH_BOOKING_LOCATION_FAILED","STOP_LOCATION_FETCH","STORE_ADRESSES","store","firebase","query","onValue","set","off","push","limitToLast","saveTracking","bookingId","location","trackingRef","fetchBookingLocations","dispatch","type","payload","snapshot","val","data","locations","Object","keys","map","i","length","getState","languagedata","defaultLanguage","location_fetch_error","stopLocationFetch","saveUserLocation","auth","userLocationRef","uid","currentUser","storeAddresses"],"sources":["C:/Users/CAJAL/Desktop/main/Sourcecode/common/src/actions/locationactions.js"],"sourcesContent":["import {\n    FETCH_BOOKING_LOCATION,\n    FETCH_BOOKING_LOCATION_SUCCESS,\n    FETCH_BOOKING_LOCATION_FAILED,\n    STOP_LOCATION_FETCH,\n    STORE_ADRESSES\n} from \"../store/types\";\nimport store from '../store/store';\nimport { firebase } from '../config/configureFirebase';\nimport { query, onValue, set, off, push, limitToLast } from \"firebase/database\";\n\nexport const saveTracking = (bookingId, location) => {\n    const {\n        trackingRef\n    } = firebase;\n    push(trackingRef(bookingId), location);\n}\n\nexport const fetchBookingLocations = (bookingId) => (dispatch) => {\n\n    const {\n        trackingRef\n    } = firebase;\n\n    dispatch({\n        type: FETCH_BOOKING_LOCATION,\n        payload: bookingId,\n    });\n    onValue(query(trackingRef(bookingId), limitToLast(1)),(snapshot) => {\n        if (snapshot.val()) {\n            let data = snapshot.val();\n            const locations = Object.keys(data)\n                .map((i) => {\n                    return data[i]\n                });\n            if (locations.length == 1) {\n                dispatch({\n                    type: FETCH_BOOKING_LOCATION_SUCCESS,\n                    payload: locations[0]\n                });\n            }\n            else {\n                dispatch({\n                    type: FETCH_BOOKING_LOCATION_FAILED,\n                    payload: store.getState().languagedata.defaultLanguage.location_fetch_error,\n                });\n            }\n        } else {\n            dispatch({\n                type: FETCH_BOOKING_LOCATION_FAILED,\n                payload: store.getState().languagedata.defaultLanguage.location_fetch_error,\n            });\n        }\n    });\n};\n\nexport const stopLocationFetch = (bookingId) => (dispatch) => {\n\n    const {\n        trackingRef\n    } = firebase;\n\n    dispatch({\n        type: STOP_LOCATION_FETCH,\n        payload: bookingId,\n    });\n    off(trackingRef(bookingId));\n}\n\nexport const saveUserLocation = (location) => {\n    const {\n      auth,\n      userLocationRef,\n    } = firebase;\n    const uid = auth.currentUser.uid;\n    set(userLocationRef(uid),location);\n}\n\nexport const storeAddresses = (data) => (dispatch) => {\n    dispatch({\n        type: STORE_ADRESSES,\n        payload: data,\n    });\n}"],"mappings":"AAAA,OACIA,sBAAsB,CACtBC,8BAA8B,CAC9BC,6BAA6B,CAC7BC,mBAAmB,CACnBC,cAAc,KACX,gBAAgB,CACvB,MAAO,CAAAC,KAAK,KAAM,gBAAgB,CAClC,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,KAAK,CAAEC,OAAO,CAAEC,GAAG,CAAEC,GAAG,CAAEC,IAAI,CAAEC,WAAW,KAAQ,mBAAmB,CAE/E,MAAO,MAAM,CAAAC,YAAY,CAAGA,CAACC,SAAS,CAAEC,QAAQ,GAAK,CACjD,KAAM,CACFC,WACJ,CAAC,CAAGV,QAAQ,CACZK,IAAI,CAACK,WAAW,CAACF,SAAS,CAAC,CAAEC,QAAQ,CAAC,CAC1C,CAAC,CAED,MAAO,MAAM,CAAAE,qBAAqB,CAAIH,SAAS,EAAMI,QAAQ,EAAK,CAE9D,KAAM,CACFF,WACJ,CAAC,CAAGV,QAAQ,CAEZY,QAAQ,CAAC,CACLC,IAAI,CAAEnB,sBAAsB,CAC5BoB,OAAO,CAAEN,SACb,CAAC,CAAC,CACFN,OAAO,CAACD,KAAK,CAACS,WAAW,CAACF,SAAS,CAAC,CAAEF,WAAW,CAAC,CAAC,CAAC,CAAC,CAAES,QAAQ,EAAK,CAChE,GAAIA,QAAQ,CAACC,GAAG,CAAC,CAAC,CAAE,CAChB,GAAI,CAAAC,IAAI,CAAGF,QAAQ,CAACC,GAAG,CAAC,CAAC,CACzB,KAAM,CAAAE,SAAS,CAAGC,MAAM,CAACC,IAAI,CAACH,IAAI,CAAC,CAC9BI,GAAG,CAAEC,CAAC,EAAK,CACR,MAAO,CAAAL,IAAI,CAACK,CAAC,CAAC,CAClB,CAAC,CAAC,CACN,GAAIJ,SAAS,CAACK,MAAM,EAAI,CAAC,CAAE,CACvBX,QAAQ,CAAC,CACLC,IAAI,CAAElB,8BAA8B,CACpCmB,OAAO,CAAEI,SAAS,CAAC,CAAC,CACxB,CAAC,CAAC,CACN,CAAC,IACI,CACDN,QAAQ,CAAC,CACLC,IAAI,CAAEjB,6BAA6B,CACnCkB,OAAO,CAAEf,KAAK,CAACyB,QAAQ,CAAC,CAAC,CAACC,YAAY,CAACC,eAAe,CAACC,oBAC3D,CAAC,CAAC,CACN,CACJ,CAAC,IAAM,CACHf,QAAQ,CAAC,CACLC,IAAI,CAAEjB,6BAA6B,CACnCkB,OAAO,CAAEf,KAAK,CAACyB,QAAQ,CAAC,CAAC,CAACC,YAAY,CAACC,eAAe,CAACC,oBAC3D,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,CACN,CAAC,CAED,MAAO,MAAM,CAAAC,iBAAiB,CAAIpB,SAAS,EAAMI,QAAQ,EAAK,CAE1D,KAAM,CACFF,WACJ,CAAC,CAAGV,QAAQ,CAEZY,QAAQ,CAAC,CACLC,IAAI,CAAEhB,mBAAmB,CACzBiB,OAAO,CAAEN,SACb,CAAC,CAAC,CACFJ,GAAG,CAACM,WAAW,CAACF,SAAS,CAAC,CAAC,CAC/B,CAAC,CAED,MAAO,MAAM,CAAAqB,gBAAgB,CAAIpB,QAAQ,EAAK,CAC1C,KAAM,CACJqB,IAAI,CACJC,eACF,CAAC,CAAG/B,QAAQ,CACZ,KAAM,CAAAgC,GAAG,CAAGF,IAAI,CAACG,WAAW,CAACD,GAAG,CAChC7B,GAAG,CAAC4B,eAAe,CAACC,GAAG,CAAC,CAACvB,QAAQ,CAAC,CACtC,CAAC,CAED,MAAO,MAAM,CAAAyB,cAAc,CAAIjB,IAAI,EAAML,QAAQ,EAAK,CAClDA,QAAQ,CAAC,CACLC,IAAI,CAAEf,cAAc,CACpBgB,OAAO,CAAEG,IACb,CAAC,CAAC,CACN,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}