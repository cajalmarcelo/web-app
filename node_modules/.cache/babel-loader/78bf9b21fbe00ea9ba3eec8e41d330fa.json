{"ast":null,"code":"import _objectSpread from\"C:/Users/CAJAL/Desktop/main/Sourcecode/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{CONFIRM_BOOKING,CONFIRM_BOOKING_SUCCESS,CONFIRM_BOOKING_FAILED,CLEAR_BOOKING}from\"../store/types\";import{RequestPushMsg}from'../other/NotificationFunctions';import store from'../store/store';import{firebase}from'../config/configureFirebase';import{formatBookingObject}from'../other/sharedFunctions';import{get,onValue,push}from\"firebase/database\";export const clearBooking=()=>dispatch=>{dispatch({type:CLEAR_BOOKING,payload:null});};export const addBooking=bookingData=>async dispatch=>{const{bookingRef,settingsRef,singleUserRef}=firebase;dispatch({type:CONFIRM_BOOKING,payload:bookingData});const settingsdata=await get(settingsRef);const settings=settingsdata.val();let data=await formatBookingObject(bookingData,settings);if(bookingData.requestedDrivers){const drivers=bookingData.requestedDrivers;Object.keys(drivers).map(uid=>{onValue(singleUserRef(uid),snapshot=>{if(snapshot.val()){const pushToken=snapshot.val().pushToken;const ios=snapshot.val().userPlatform==\"IOS\"?true:false;if(pushToken){RequestPushMsg(pushToken,{title:store.getState().languagedata.defaultLanguage.notification_title,msg:store.getState().languagedata.defaultLanguage.new_booking_notification,screen:'DriverTrips'});}}},{onlyOnce:true});return drivers[uid];});}push(bookingRef,data).then(res=>{var bookingKey=res.key;dispatch({type:CONFIRM_BOOKING_SUCCESS,payload:{booking_id:bookingKey,mainData:_objectSpread(_objectSpread({},data),{},{id:bookingKey})}});}).catch(error=>{dispatch({type:CONFIRM_BOOKING_FAILED,payload:error.code+\": \"+error.message});});};","map":{"version":3,"names":["CONFIRM_BOOKING","CONFIRM_BOOKING_SUCCESS","CONFIRM_BOOKING_FAILED","CLEAR_BOOKING","RequestPushMsg","store","firebase","formatBookingObject","get","onValue","push","clearBooking","dispatch","type","payload","addBooking","bookingData","bookingRef","settingsRef","singleUserRef","settingsdata","settings","val","data","requestedDrivers","drivers","Object","keys","map","uid","snapshot","pushToken","ios","userPlatform","title","getState","languagedata","defaultLanguage","notification_title","msg","new_booking_notification","screen","onlyOnce","then","res","bookingKey","key","booking_id","mainData","_objectSpread","id","catch","error","code","message"],"sources":["C:/Users/CAJAL/Desktop/main/Sourcecode/common/src/actions/bookingactions.js"],"sourcesContent":["import {\n    CONFIRM_BOOKING,\n    CONFIRM_BOOKING_SUCCESS,\n    CONFIRM_BOOKING_FAILED,\n    CLEAR_BOOKING\n} from \"../store/types\";\nimport { RequestPushMsg } from '../other/NotificationFunctions';\nimport store from '../store/store';\nimport { firebase } from '../config/configureFirebase';\nimport { formatBookingObject } from '../other/sharedFunctions';\nimport { get, onValue, push } from \"firebase/database\";\n\nexport const clearBooking = () => (dispatch) => {\n    dispatch({\n        type: CLEAR_BOOKING,\n        payload: null,\n    });\n}\n\nexport const addBooking = (bookingData) => async (dispatch) => {\n\n    const   {\n        bookingRef,\n        settingsRef,\n        singleUserRef\n    } = firebase;\n\n    dispatch({\n        type: CONFIRM_BOOKING,\n        payload: bookingData,\n    });\n\n    const settingsdata = await get(settingsRef);\n    const settings = settingsdata.val();\n\n    let data = await formatBookingObject(bookingData, settings);\n\n    if(bookingData.requestedDrivers){\n        const drivers = bookingData.requestedDrivers;\n        Object.keys(drivers).map((uid)=>{\n            onValue(singleUserRef(uid),  snapshot => {\n                if (snapshot.val()) {\n                    const pushToken = snapshot.val().pushToken;\n                    const ios = snapshot.val().userPlatform == \"IOS\"? true: false\n                    if(pushToken){\n                        RequestPushMsg(\n                            pushToken,\n                            {\n                                title: store.getState().languagedata.defaultLanguage.notification_title,\n                                msg: store.getState().languagedata.defaultLanguage.new_booking_notification,\n                                screen: 'DriverTrips'\n                            });\n                     }\n                 }\n            }, {onlyOnce: true});\n            return drivers[uid];\n        })\n    }\n\n    push(bookingRef, data).then((res) => {\n        var bookingKey = res.key;\n        dispatch({\n            type: CONFIRM_BOOKING_SUCCESS,\n            payload: {\n                booking_id:bookingKey,\n                mainData:{\n                    ...data,\n                    id:bookingKey\n                }\n            }    \n        });\n    }).catch(error => {\n        dispatch({\n            type: CONFIRM_BOOKING_FAILED,\n            payload: error.code + \": \" + error.message,\n        });\n    });\n};\n\n"],"mappings":"2HAAA,OACIA,eAAe,CACfC,uBAAuB,CACvBC,sBAAsB,CACtBC,aAAa,KACV,gBAAgB,CACvB,OAASC,cAAc,KAAQ,gCAAgC,CAC/D,MAAO,CAAAC,KAAK,KAAM,gBAAgB,CAClC,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,mBAAmB,KAAQ,0BAA0B,CAC9D,OAASC,GAAG,CAAEC,OAAO,CAAEC,IAAI,KAAQ,mBAAmB,CAEtD,MAAO,MAAM,CAAAC,YAAY,CAAGA,CAAA,GAAOC,QAAQ,EAAK,CAC5CA,QAAQ,CAAC,CACLC,IAAI,CAAEV,aAAa,CACnBW,OAAO,CAAE,IACb,CAAC,CAAC,CACN,CAAC,CAED,MAAO,MAAM,CAAAC,UAAU,CAAIC,WAAW,EAAK,KAAO,CAAAJ,QAAQ,EAAK,CAE3D,KAAQ,CACJK,UAAU,CACVC,WAAW,CACXC,aACJ,CAAC,CAAGb,QAAQ,CAEZM,QAAQ,CAAC,CACLC,IAAI,CAAEb,eAAe,CACrBc,OAAO,CAAEE,WACb,CAAC,CAAC,CAEF,KAAM,CAAAI,YAAY,CAAG,KAAM,CAAAZ,GAAG,CAACU,WAAW,CAAC,CAC3C,KAAM,CAAAG,QAAQ,CAAGD,YAAY,CAACE,GAAG,CAAC,CAAC,CAEnC,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAAhB,mBAAmB,CAACS,WAAW,CAAEK,QAAQ,CAAC,CAE3D,GAAGL,WAAW,CAACQ,gBAAgB,CAAC,CAC5B,KAAM,CAAAC,OAAO,CAAGT,WAAW,CAACQ,gBAAgB,CAC5CE,MAAM,CAACC,IAAI,CAACF,OAAO,CAAC,CAACG,GAAG,CAAEC,GAAG,EAAG,CAC5BpB,OAAO,CAACU,aAAa,CAACU,GAAG,CAAC,CAAGC,QAAQ,EAAI,CACrC,GAAIA,QAAQ,CAACR,GAAG,CAAC,CAAC,CAAE,CAChB,KAAM,CAAAS,SAAS,CAAGD,QAAQ,CAACR,GAAG,CAAC,CAAC,CAACS,SAAS,CAC1C,KAAM,CAAAC,GAAG,CAAGF,QAAQ,CAACR,GAAG,CAAC,CAAC,CAACW,YAAY,EAAI,KAAK,CAAE,IAAI,CAAE,KAAK,CAC7D,GAAGF,SAAS,CAAC,CACT3B,cAAc,CACV2B,SAAS,CACT,CACIG,KAAK,CAAE7B,KAAK,CAAC8B,QAAQ,CAAC,CAAC,CAACC,YAAY,CAACC,eAAe,CAACC,kBAAkB,CACvEC,GAAG,CAAElC,KAAK,CAAC8B,QAAQ,CAAC,CAAC,CAACC,YAAY,CAACC,eAAe,CAACG,wBAAwB,CAC3EC,MAAM,CAAE,aACZ,CAAC,CAAC,CACT,CACJ,CACL,CAAC,CAAE,CAACC,QAAQ,CAAE,IAAI,CAAC,CAAC,CACpB,MAAO,CAAAjB,OAAO,CAACI,GAAG,CAAC,CACvB,CAAC,CAAC,CACN,CAEAnB,IAAI,CAACO,UAAU,CAAEM,IAAI,CAAC,CAACoB,IAAI,CAAEC,GAAG,EAAK,CACjC,GAAI,CAAAC,UAAU,CAAGD,GAAG,CAACE,GAAG,CACxBlC,QAAQ,CAAC,CACLC,IAAI,CAAEZ,uBAAuB,CAC7Ba,OAAO,CAAE,CACLiC,UAAU,CAACF,UAAU,CACrBG,QAAQ,CAAAC,aAAA,CAAAA,aAAA,IACD1B,IAAI,MACP2B,EAAE,CAACL,UAAU,EAErB,CACJ,CAAC,CAAC,CACN,CAAC,CAAC,CAACM,KAAK,CAACC,KAAK,EAAI,CACdxC,QAAQ,CAAC,CACLC,IAAI,CAAEX,sBAAsB,CAC5BY,OAAO,CAAEsC,KAAK,CAACC,IAAI,CAAG,IAAI,CAAGD,KAAK,CAACE,OACvC,CAAC,CAAC,CACN,CAAC,CAAC,CACN,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}