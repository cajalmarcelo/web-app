{"ast":null,"code":"import{FETCH_CARS,FETCH_CARS_SUCCESS,FETCH_CARS_FAILED,EDIT_CAR}from\"../store/types\";import store from'../store/store';import{firebase}from'../config/configureFirebase';import{onValue,update,set,child,remove,push}from\"firebase/database\";import{uploadBytesResumable,getDownloadURL}from\"firebase/storage\";export const fetchCars=()=>dispatch=>{const{carsRef}=firebase;dispatch({type:FETCH_CARS,payload:null});const userInfo=store.getState().auth.profile;onValue(carsRef(userInfo.uid,userInfo.usertype),snapshot=>{if(snapshot.val()){let data=snapshot.val();const arr=Object.keys(data).map(i=>{data[i].id=i;return data[i];});dispatch({type:FETCH_CARS_SUCCESS,payload:arr});}else{dispatch({type:FETCH_CARS_FAILED,payload:store.getState().languagedata.defaultLanguage.no_cars});}});};export const editCar=(car,method)=>async dispatch=>{const{singleUserRef,carAddRef,carEditRef,carImage}=firebase;dispatch({type:EDIT_CAR,payload:{method,car}});if(method==='Add'){push(carAddRef,car);}else if(method==='Delete'){remove(carEditRef(car.id));}else if(method==='UpdateImage'){await uploadBytesResumable(carImage(car.id),car.car_image);let image=await getDownloadURL(carImage(car.id));let data=car;data.car_image=image;set(carEditRef(car.id),data);if(car.active&&car.driver){update(singleUserRef(car.driver),{updateAt:new Date().getTime(),car_image:image});}}else{set(carEditRef(car.id),car);}};export const updateUserCarWithImage=(newData,blob)=>dispatch=>{const{auth,carAddRef,singleUserRef,carImage}=firebase;var carId=push(carAddRef).key;uploadBytesResumable(carImage(carId),blob).then(()=>{blob.close();return getDownloadURL(carImage(carId));}).then(url=>{newData.car_image=url;set(child(carAddRef,carId),newData);if(newData.active){let updateData={carType:newData.carType,vehicleNumber:newData.vehicleNumber,vehicleMake:newData.vehicleMake,vehicleModel:newData.vehicleModel,other_info:newData.other_info,car_image:url,carApproved:newData.approved,updateAt:new Date().getTime()};update(singleUserRef(auth.currentUser.uid),updateData);}});};","map":{"version":3,"names":["FETCH_CARS","FETCH_CARS_SUCCESS","FETCH_CARS_FAILED","EDIT_CAR","store","firebase","onValue","update","set","child","remove","push","uploadBytesResumable","getDownloadURL","fetchCars","dispatch","carsRef","type","payload","userInfo","getState","auth","profile","uid","usertype","snapshot","val","data","arr","Object","keys","map","i","id","languagedata","defaultLanguage","no_cars","editCar","car","method","singleUserRef","carAddRef","carEditRef","carImage","car_image","image","active","driver","updateAt","Date","getTime","updateUserCarWithImage","newData","blob","carId","key","then","close","url","updateData","carType","vehicleNumber","vehicleMake","vehicleModel","other_info","carApproved","approved","currentUser"],"sources":["C:/Users/CAJAL/Desktop/main/Sourcecode/common/src/actions/caractions.js"],"sourcesContent":["import {\n    FETCH_CARS,\n    FETCH_CARS_SUCCESS,\n    FETCH_CARS_FAILED,\n    EDIT_CAR\n  } from \"../store/types\";\n  import store from '../store/store';\n  import { firebase } from '../config/configureFirebase';\n  import { onValue, update, set, child, remove, push } from \"firebase/database\";\n  import { uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\n  \n  export const fetchCars = () => (dispatch) => {\n  \n    const {\n        carsRef\n    } = firebase;\n  \n    dispatch({\n      type: FETCH_CARS,\n      payload: null\n    });\n\n    const userInfo = store.getState().auth.profile;\n\n    onValue(carsRef(userInfo.uid, userInfo.usertype), snapshot => {\n      if (snapshot.val()) {\n        let data = snapshot.val();\n        const arr = Object.keys(data).map(i => {\n          data[i].id = i;\n          return data[i]\n        });\n        dispatch({\n          type: FETCH_CARS_SUCCESS,\n          payload: arr\n        });\n      } else {\n        dispatch({\n          type: FETCH_CARS_FAILED,\n          payload: store.getState().languagedata.defaultLanguage.no_cars\n        });\n      }\n    });\n  };\n  \n  export const editCar = (car, method) => async (dispatch) => {\n    const {\n      singleUserRef,\n      carAddRef, \n      carEditRef,\n      carImage\n    } = firebase;\n    dispatch({\n      type: EDIT_CAR,\n      payload: { method, car }\n    });\n    if (method === 'Add') {\n        push(carAddRef, car);\n    } else if (method === 'Delete') {\n        remove(carEditRef(car.id));\n    } else if (method === 'UpdateImage') {\n      await uploadBytesResumable(carImage(car.id),car.car_image);\n      let image = await getDownloadURL(carImage(car.id));\n      let data = car;\n      data.car_image = image;\n      set(carEditRef(car.id), data);\n      if(car.active && car.driver){\n        update(singleUserRef(car.driver), {\n          updateAt: new Date().getTime(),\n          car_image: image\n        });\n      }   \n    }\n     else {\n        set(carEditRef(car.id),car);\n    }\n  }\n\n  export const updateUserCarWithImage = (newData, blob) => (dispatch) => {\n    const {\n      auth,\n      carAddRef,\n      singleUserRef,\n      carImage\n    } = firebase;\n\n    var carId = push(carAddRef).key;\n\n    uploadBytesResumable(carImage(carId),blob).then(() => {\n      blob.close()\n      return getDownloadURL(carImage(carId))\n    }).then((url) => {\n      newData.car_image = url;\n      set(child(carAddRef, carId),newData )\n      if(newData.active){\n        let updateData = {\n          carType: newData.carType,\n          vehicleNumber: newData.vehicleNumber,\n          vehicleMake: newData.vehicleMake,\n          vehicleModel: newData.vehicleModel,\n          other_info: newData.other_info,\n          car_image:url,\n          carApproved: newData.approved,\n          updateAt: new Date().getTime()\n        };\n        update(singleUserRef(auth.currentUser.uid),updateData);\n      }\n    })\n  };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}